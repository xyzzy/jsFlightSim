<!DOCTYPE html>
<!--
	Flight simulator written in javascript
	https://github.com/xyzzy/jsFlightSim

	Copyright 2018 https://github.com/xyzzy

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Affero General Public License as published
	by the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Affero General Public License for more details.

	You should have received a copy of the GNU Affero General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>jsFlightSim</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
	<style type="text/css">
		body {
			font-family: Verdana, Geneva, sans-serif;
		}
	</style>
</head>
<body>

<h1>jsFlightSim image/GIF mode</h1>

<p>Construct a GIF image with javascript and load data into an &lt;img&gt; element.</p>

<p>Arrows for movement.<br/>
	Page up/down for faster/slower.<br/>
	Home for re-center stick.</p>

<p>
	<a href="javascript:setScenery1()">Scenery1</a>
	<a href="javascript:setScenery2()">Scenery2</a>
	<a href="javascript:clearInterval(gTimer);tis=undefined">STOP</a>
	<a href="jsFlightSim-canvas-draw.html">Switch to canvas/draw mode</a>
</p>

<img id="img" src="">
<div id="stat"></div>
<br clear="all"/>

<script type="text/javascript" src="jsGifEncoder.js"></script>
<script type="text/javascript">

	var upState = 0, downState = 0, leftState = 0, rightState = 0, fastState = 0, slowState = 0;
	var gTimer;

	var gCoordX = [0];
	var gCoordY = [0];
	var gCoordZ = [0];
	var gFrameNr = 0;
	var gBPP = 4;
	var gRed = [230, 135, 75, 254, 255, 246, 223, 255, 255, 197, 255, 255, 214, 108, 255, 255];
	var gGreen = [179, 135, 75, 203, 244, 246, 223, 212, 224, 146, 235, 247, 214, 108, 255, 255];
	var gBlue = [78, 135, 75, 102, 142, 246, 223, 111, 123, 45, 133, 145, 214, 108, 153, 255];
	var gAvgTime = 0;
	var gPixels;

	var gWidth, gHeight, gEncoder, gImage, gStat;

	window.addEventListener("load", function () {

		gWidth = Math.round(document.body.clientWidth * 0.9);
		gHeight = Math.round(document.body.clientHeight * 0.7);

		// fixed size until algorithm has been adapted
		gWidth = 600;
		gHeight = 600;

		// get dom elements
		gEncoder = new GifEncoder(gWidth, gHeight);
		gImage = document.getElementById('img');
		gStat = document.getElementById('stat');

		// size image
		gImage.width = gWidth;
		gImage.height = gHeight;

		// draw initial frame
		gPixels = new Uint8Array(gWidth * gHeight);
		gImage.src = gEncoder.encode(gBPP, gRed, gGreen, gBlue, gPixels);

	});

	var dt = 0.02, j, H, M, D, F, P, E, O, T, d, o, v, i, c, L, X, l, u, J, h;

	function setScenery1() {
		if (gTimer !== undefined)
			clearInterval(gTimer);
		gCoordX = [1000000, 987688, 951056, 891006, 809017, 707106, 587785, 453990, 309017, 156434, 0, -156434, -309016, -453990, -587785, -707106, -809016, -891006, -951056, -987688, -999999, -987688, -951056, -891006, -809017, -707106, -587785, -453990, -309017, -156434, 0, 156434, 309016, 453990, 587785, 707106, 809016, 891006, 951056, 987688, 1000000, 0, 6511, 6267, 7095, 7339, 6511, 6803, 7095, 0, 6267, 6803, 7339, 0, 24046, 23575, 24236, 24707, 24046, 24141, 24236, 0, 23575, 24141, 24707, 0, 26090, 25960, 26150, 26280, 26090, 26120, 26150, 0, 25960, 26120, 26280, 0, 41193, 40827, 41348, 41714, 41193, 41271, 41348, 0, 40827, 41271, 41714, 0, 17255, 16887, 17410, 17776, 17255, 17332, 17410, 0, 16887, 17332, 17776, 0, 45863, 45495, 46018, 46383, 45863, 45940, 46018, 0, 45495, 45940, 46383, 0, 66583, 66112, 66772, 67243, 66583, 66678, 66772, 0, 66112, 66678, 67243, 0, 75995, 76008, 75338, 75264, 75995, 77039, 76008, 76964, 0, 77039, 76292, 75264, 0, 76964, 76280, 75338, 0, 76280, 76292, 0, 76021, 76033, 75485, 75412, 76021, 76890, 76033, 76816, 0, 76890, 76268, 75412, 0, 76816, 76256, 75485, 0, 76256, 76268, 0, 76046, 76059, 75632, 75559, 76046, 76742, 76059, 76667, 0, 76742, 76244, 75559, 0, 76667, 76232, 75632, 0, 76232, 76244, 0, 76072, 76084, 75780, 75706, 76072, 76593, 76084, 76519, 0, 76593, 76220, 75706, 0, 76519, 76208, 75780, 0, 76208, 76220, 0, 76097, 76110, 75927, 75853, 76097, 76445, 76110, 76370, 0, 76445, 76196, 75853, 0, 76370, 76184, 75927, 0, 76184, 76196, 0, 76122, 76135, 76074, 76000, 76122, 76296, 76135, 76222, 0, 76296, 76172, 76000, 0, 76222, 76160, 76074, 0, 76160, 76172, 0, 86332, 85964, 86486, 86852, 86332, 86408, 86486, 0, 85964, 86408, 86852, 0, 46429, 46299, 46489, 46619, 46429, 46459, 46489, 0, 46299, 46459, 46619, 0, 97292, 98318, 99051, 98025, 97292, 98171, 99051, 0, 98318, 98171, 98025, 0, 99469, 98998, 99659, 100130, 99469, 99564, 99659, 0, 98998, 99564, 100130, 0, 97982, 98832, 99434, 98583, 97982, 98708, 99434, 0, 98832, 98708, 98583, 0, 2114, 2687, 3259, 3831, 4371, 4911, 5451, 5994, 6536, 7079, 7622, 8209, 8795, 9382, 9969, 10506, 11043, 11580, 12117, 12654, 13191, 13727, 14311, 14894, 15477, 16032, 16588, 17143, 17698, 18254, 18809, 19359, 19909, 20459, 21009, 21580, 22151, 22722, 23292, 23863, 24377, 24891, 25405, 25919, 26232, 26545, 26857, 27564, 28270, 28746, 29222, 29698, 30195, 30693, 31190, 31750, 32310, 32871, 33431, 33828, 34226, 34624, 35297, 35970, 36578, 37185, 37571, 37957, 38305, 38652, 38865, 39078, 39658, 40205, 40752, 41324, 41895, 42636, 42638, 43131, 43623, 44139, 44655, 45171, 45687, 46142, 46598, 47053, 47509, 47965, 48420, 48978, 49535, 50093, 50650, 51171, 51691, 52211, 52731, 53250, 53768, 54287, 54806, 55324, 55843, 56362, 56873, 57384, 57895, 58407, 58918, 59579, 60240, 60901, 61338, 61776, 62214, 62932, 63649, 64173, 64697, 65221, 65624, 66027, 66602, 67177, 67810, 68444, 68978, 69513, 70047, 70582, 71116, 71651, 72185, 72720, 73255, 73789, 74324, 74828, 75332, 75837, 76341, 76846, 77350, 77855, 78359, 78758, 79157, 79556, 80006, 80456, 80906, 81355, 81805, 82255, 82807, 83360, 83912, 84464, 85016, 85522, 86028, 86534, 87040, 87546, 88052, 88558, 89172, 89786, 90400, 91014, 91601, 92187, 92774, 93361, 93916, 94472, 95027, 95546, 96065, 96584, 97103, 97621, 98140, 98611, 99083, 99554, 100083, 100612, 101142, 101671, 102200, 102729, 103258, 103788, 104317, 104846, 105375, 105904, 0, 2162, 2734, 3306, 3878, 4401, 4923, 5446, 5998, 6550, 7102, 7654, 8223, 8793, 9363, 9933, 10498, 11063, 11628, 12193, 12759, 13324, 13889, 14383, 14877, 15371, 15865, 16455, 17046, 17636, 18226, 18817, 19430, 20044, 20657, 21197, 21736, 22275, 22815, 23354, 23893, 24403, 24912, 25422, 25885, 26348, 26811, 27425, 28040, 28486, 28931, 29377, 29988, 30598, 31209, 31785, 32361, 32937, 33512, 34119, 34727, 35398, 36070, 36579, 37088, 37479, 37871, 38329, 38658, 38931, 39401, 39994, 40587, 41154, 41721, 42286, 42850, 43446, 44042, 44578, 45115, 45651, 46108, 46565, 47022, 47480, 47937, 48394, 48957, 49520, 50083, 50646, 51144, 51642, 52140, 52638, 53145, 53653, 54160, 54667, 55175, 55682, 56189, 56738, 57287, 57835, 58384, 58933, 59564, 60196, 60828, 61438, 62049, 62552, 63055, 63558, 64060, 64561, 65062, 65504, 65945, 66561, 67177, 67811, 68445, 68973, 69502, 70030, 70558, 71087, 71615, 72143, 72672, 73200, 73728, 74205, 74682, 75159, 75636, 76113, 76590, 77067, 77544, 78021, 78467, 78912, 79358, 79777, 80196, 80614, 81033, 81452, 81871, 82336, 82801, 83266, 83731, 84196, 84661, 85179, 85696, 86214, 86732, 87250, 87767, 88285, 88803, 89320, 89838, 90356, 90873, 91376, 91879, 92382, 92885, 93388, 93890, 94393, 94896, 95399, 95902, 96405, 96908, 97410, 97913, 98416, 98945, 99473, 100002, 100530, 101059, 101588, 102116, 102645, 103173, 103702, 104230, 104759, 105288, 105816, 0, 92115, 92688, 93260, 93832, 94152, 94092, 93530, 92812, 92133, 92115, 92115, 0, 94634, 94977, 95769, 96425, 97082, 97609, 98137, 98557, 98398, 97556, 97062, 96519, 95976, 95484, 94993, 94618, 94582, 94634, 94634, 0, 24830, 24832, 24979, 25332, 25641, 26002, 26128, 25983, 25463, 25129, 24830, 24830, 0, 30671, 30754, 30609, 30151, 29513, 28801, 28260, 27538, 27392, 27936, 28549, 28991, 29395, 29709, 30334, 30671, 30671, 0];
		gCoordY = [0, 156434, 309016, 453990, 587785, 707106, 809016, 891006, 951056, 987688, 999999, 987688, 951056, 891006, 809017, 707106, 587785, 453990, 309017, 156434, 0, -156434, -309016, -453990, -587785, -707106, -809016, -891006, -951056, -987688, -999999, -987688, -951056, -891006, -809017, -707106, -587785, -453990, -309017, -156434, 0, 0, -1785, -952, -739, -1571, -1785, -1262, -739, 0, -952, -1262, -1571, 0, -16204, -15543, -15072, -15732, -16204, -15638, -15072, 0, -15543, -15638, -15732, 0, -16254, -16064, -15934, -16124, -16254, -16094, -15934, 0, -16064, -16094, -16124, 0, -15685, -15165, -14799, -15320, -15685, -15242, -14799, 0, -15165, -15242, -15320, 0, -4645, -4140, -3759, -4280, -4645, -4206, -3759, 0, -4140, -4206, -4280, 0, -17213, -16708, -16327, -16848, -17213, -16774, -16327, 0, -16708, -16774, -16848, 0, -8805, -8145, -7673, -8334, -8805, -8239, -7673, 0, -8145, -8239, -8334, 0, -18851, -18777, -17822, -17810, -18851, -18105, -18777, -18092, 0, -18105, -17062, -17810, 0, -18092, -17136, -17822, 0, -17136, -17062, 0, -18702, -18628, -17847, -17835, -18702, -18080, -18628, -18068, 0, -18080, -17211, -17835, 0, -18068, -17285, -17847, 0, -17285, -17211, 0, -18553, -18479, -17871, -17859, -18553, -18055, -18479, -18043, 0, -18055, -17360, -17859, 0, -18043, -17435, -17871, 0, -17435, -17360, 0, -18404, -18330, -17896, -17884, -18404, -18031, -18330, -18019, 0, -18031, -17509, -17884, 0, -18019, -17584, -17896, 0, -17584, -17509, 0, -18255, -18180, -17920, -17908, -18255, -18006, -18180, -17994, 0, -18006, -17658, -17908, 0, -17994, -17733, -17920, 0, -17733, -17658, 0, -18106, -18031, -17945, -17932, -18106, -17982, -18031, -17969, 0, -17982, -17808, -17932, 0, -17969, -17882, -17945, 0, -17882, -17808, 0, -23736, -23231, -22850, -23371, -23736, -23297, -22850, 0, -23231, -23297, -23371, 0, -18090, -17900, -17770, -17960, -18090, -17930, -17770, 0, -17900, -17930, -17960, 0, -27848, -27115, -28141, -28874, -27848, -27994, -28141, 0, -27115, -27994, -28874, 0, -23347, -22687, -22216, -22876, -23347, -22782, -22216, 0, -22687, -22782, -22876, 0, -24924, -24323, -25173, -25775, -24924, -25049, -25173, 0, -24323, -25049, -25775, 0, 800, 1012, 1225, 1437, 1643, 1850, 2056, 2188, 2319, 2451, 2582, 2583, 2583, 2583, 2584, 2538, 2492, 2446, 2400, 2354, 2308, 2263, 2479, 2695, 2911, 2778, 2646, 2514, 2381, 2249, 2117, 2161, 2206, 2251, 2295, 2303, 2311, 2319, 2327, 2335, 2205, 2074, 1944, 1813, 1326, 839, 352, 144, -63, -354, -644, -935, -1072, -1210, -1347, -1202, -1057, -912, -767, -421, -75, 270, 270, 270, 138, 7, -367, -742, -1111, -1480, -1972, -2463, -2795, -2855, -2916, -2690, -2465, -2428, -2412, -2528, -2643, -2872, -3100, -3329, -3557, -3788, -4018, -4249, -4479, -4710, -4940, -5179, -5417, -5655, -5893, -6091, -6289, -6487, -6684, -6701, -6717, -6734, -6750, -6767, -6783, -6800, -6702, -6604, -6507, -6409, -6311, -6398, -6485, -6572, -6873, -7174, -7476, -7662, -7848, -8057, -8265, -8474, -8836, -9197, -9340, -9483, -9430, -9378, -9462, -9547, -9631, -9716, -9800, -9885, -9970, -10054, -10139, -10223, -10308, -10478, -10648, -10818, -10988, -11158, -11329, -11499, -11669, -12100, -12531, -12963, -13234, -13506, -13777, -14049, -14320, -14591, -14806, -15021, -15236, -15451, -15665, -15740, -15815, -15891, -15966, -16041, -16116, -16191, -16276, -16362, -16448, -16534, -16424, -16314, -16204, -16094, -16151, -16207, -16264, -16284, -16304, -16325, -16345, -16365, -16385, -16597, -16809, -17021, -17023, -17025, -17027, -17029, -17031, -17034, -17036, -17038, -17040, -17042, -17044, -17046, 0, 465, 677, 889, 1102, 1258, 1415, 1571, 1713, 1856, 1998, 2140, 2185, 2231, 2277, 2323, 2255, 2187, 2120, 2052, 1984, 1916, 1849, 1940, 2032, 2123, 2215, 2139, 2062, 1986, 1910, 1834, 1895, 1955, 2016, 1992, 1969, 1946, 1923, 1900, 1877, 1566, 1255, 944, 597, 251, -94, -399, -704, -1100, -1496, -1892, -1852, -1812, -1772, -1571, -1369, -1168, -967, -597, -228, -181, -134, -299, -464, -800, -1137, -1889, -2561, -2959, -3181, -3193, -3206, -3066, -2926, -2919, -2911, -3127, -3344, -3575, -3806, -4038, -4294, -4551, -4808, -5065, -5322, -5578, -5806, -6033, -6260, -6487, -6619, -6752, -6884, -7016, -7033, -7050, -7067, -7084, -7101, -7119, -7136, -7062, -6988, -6915, -6841, -6767, -6876, -6985, -7094, -7485, -7875, -7971, -8068, -8164, -8458, -8752, -9047, -9304, -9561, -9804, -10046, -9876, -9707, -9801, -9895, -9989, -10083, -10177, -10271, -10365, -10459, -10553, -10647, -10818, -10989, -11160, -11331, -11502, -11673, -11843, -12014, -12185, -12581, -12977, -13373, -13661, -13949, -14237, -14525, -14813, -15101, -15302, -15502, -15703, -15903, -16104, -16304, -16361, -16418, -16474, -16531, -16587, -16644, -16700, -16757, -16814, -16870, -16927, -16983, -17028, -17074, -17119, -17164, -17209, -17254, -17299, -17344, -17389, -17435, -17480, -17525, -17570, -17615, -17660, -17654, -17647, -17640, -17633, -17627, -17620, -17613, -17606, -17600, -17593, -17586, -17579, -17573, -17566, 0, -16718, -16767, -16816, -16864, -16705, -16462, -16337, -16440, -16705, -16718, -16718, 0, -16835, -17071, -17228, -17179, -17130, -17274, -17418, -17210, -16891, -16758, -16595, -16730, -16866, -16688, -16510, -16614, -16765, -16835, -16835, 0, 1637, 1762, 1804, 1755, 1617, 1176, 845, 818, 1126, 1423, 1637, 1637, 0, -1587, -1443, -1360, -1280, -1144, -747, -359, -39, -81, -439, -759, -1181, -1535, -1641, -1650, -1587, -1587, 0];
		gCoordZ = [-18084, -15630, -201, 5139, 24594, -19208, -21229, -15010, -13161, 20032, -20092, -7521, 18472, 8668, -12963, -22986, -19944, 15048, 20336, 6819, 13015, 7485, -15857, 6584, 21741, -1338, -1247, 2410, 14432, 12342, 5533, 2973, 21713, -19668, -16888, 21307, -13876, -13116, -18702, -2036, -18084, 0, -30, -30, -30, -30, -30, -577, -30, 0, -30, -577, -30, 0, -30, -30, -30, -30, -30, -546, -30, 0, -30, -546, -30, 0, -30, -30, -30, -30, -30, -176, -30, 0, -30, -176, -30, 0, -30, -30, -30, -30, -30, -434, -30, 0, -30, -434, -30, 0, -30, -30, -30, -30, -30, -434, -30, 0, -30, -434, -30, 0, -30, -30, -30, -30, -30, -434, -30, 0, -30, -434, -30, 0, -30, -30, -30, -30, -30, -546, -30, 0, -30, -546, -30, 0, -30, -150, -150, -30, -30, -30, -150, -150, 0, -30, -30, -30, 0, -150, -150, -150, 0, -150, -30, 0, -150, -270, -270, -150, -150, -150, -270, -270, 0, -150, -150, -150, 0, -270, -270, -270, 0, -270, -150, 0, -270, -391, -391, -270, -270, -270, -391, -391, 0, -270, -270, -270, 0, -391, -391, -391, 0, -391, -270, 0, -391, -511, -511, -391, -391, -391, -511, -511, 0, -391, -391, -391, 0, -511, -511, -511, 0, -511, -391, 0, -511, -632, -632, -511, -511, -511, -632, -632, 0, -511, -511, -511, 0, -632, -632, -632, 0, -632, -511, 0, -632, -752, -752, -632, -632, -632, -752, -752, 0, -632, -632, -632, 0, -752, -752, -752, 0, -752, -632, 0, -30, -30, -30, -30, -30, -434, -30, 0, -30, -434, -30, 0, -30, -30, -30, -30, -30, -176, -30, 0, -30, -176, -30, 0, -30, -30, -30, -30, -30, -832, -30, 0, -30, -832, -30, 0, -30, -30, -30, -30, -30, -546, -30, 0, -30, -546, -30, 0, -30, -30, -30, -30, -30, -692, -30, 0, -30, -692, -30, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
		gTimer = setInterval(buildFrame, 20);
		j = 33e-3;
		H = 0;
		M = 0;
		D = 1;
		F = 0;
		P = 0;
		E = 0;
		O = 0;
		T = 0;
		d = 0;
		o = 0;
		v = 0;
		i = 1E3;
		c = 0;
		L = 0;
		X = 7.26;
		l = 221;
		u = 0;
		J = 0;
		h = 8;
	}

	function setScenery2() {
		if (gTimer !== undefined)
			clearInterval(gTimer);
		gCoordX = [1000000, 951057, 809017, 587785, 309017, 0, -309017, -587785, -809017, -951057, -1000000, -951057, -809017, -587785, -309017, 0, 309017, 587785, 809017, 951057, 1000000, 0,
			-4851, -5301, -5487, -5115, -4014, -2573, -1498, -423, 651, 1790, 2929, 3632, 4334, 5037, 5409, 5781, 6153, 5928, 5704, 5680, 5657, 6122, 6587, 7052, 7517, 8401, 8571, 8982, 9393, 9889, 10385, 11185, 11986, 12787, 13516, 14244, 14973, 15701, 16729, 17757, 18786, 19741, 20697, 21653, 22924, 23420, 23916, 24412, 24893, 25373, 0, -5890, -6083, -6277, -5936, -4557, -2836, -1756, -676, 403, 1689, 2658, 3627, 4185, 4743, 4983, 5223, 5073, 4923, 4774, 4758, 4743, 5266, 5789, 6312, 6835, 7445, 8054, 8664, 9362, 10049, 10736, 11423, 12282, 13140, 13999, 14858, 15717, 16972, 18197, 18631, 19623, 20599, 21917, 0, 22707, 21343, 20049, 18755, 17786, 16817, 15748, 14678, 13632, 12586, 11578, 10431, 9842, 9455, 9594, 10075, 10586, 11098, 12152, 13004, 13857, 14709, 15593, 16476, 17360, 18135, 18910, 19741, 20573, 21405, 22482, 23560, 24288, 25017, 25347, 25678, 26009, 26210, 26412, 0, 6525, 6335, 6145, 5955, 5766, 5797, 6401, 7540, 8680, 9594, 10462, 11353, 12245, 12973, 0, 10385, 9625, 8742, 7571, 6401, 5828, 6296, 6765, 7234, 7703, 8881, 10059, 10788, 11160, 12152, 11268, 10385, 10385, 0, 10323, 9331, 9346, 10338, 10323, 10323, 0, 10571, 9579, 9594, 10586, 10571, 10571, 0, 10757, 9765, 9780, 10772, 10757, 10757, 0, 0, 8602, 8602, 8525, 8602, 8525, 8602, 8525, 8602, 8525, 8525, 8711, 8525, 8711, 8525, 8711, 8525, 8711, 8711, 8602, 8711, 8602, 8711, 8602, 8711, 8602, 8602, 8602, 8602, 8602, 8602, 8602, 8602, 8602, 0, 7905, 7905, 7827, 7905, 7827, 7905, 7827, 7827, 7781, 7827, 7781, 7827, 7781, 7781, 7812, 7781, 7812, 7781, 7812, 7812, 7889, 7812, 7889, 7812, 7889, 7889, 7967, 7889, 7967, 7889, 7967, 7967, 8013, 7967, 8013, 7967, 8013, 8013, 7982, 8013, 7982, 8013, 7982, 7982, 7905, 7982, 7905, 7982, 7905, 7905, 7905, 7905, 7905, 7905, 7905, 0, 8246, 8246, 8277, 8246, 8277, 8277, 8556, 8277, 8556, 8556, 8525, 8556, 8525, 8525, 8246, 8525, 8246, 8246, 8246, 8246, 8246, 0, 8416, 8416, 8478, 8416, 8478, 8416, 8478, 8478, 8649, 8478, 8649, 8478, 8649, 8649, 8587, 8649, 8587, 8649, 8587, 8587, 8416, 8587, 8416, 8587, 8416, 8416, 8416, 8416, 8416, 8416, 8416, 0, 7657, 7657, 7595, 7657, 7595, 7657, 7595, 7595, 7750, 7595, 7750, 7595, 7750, 7750, 7812, 7750, 7812, 7750, 7812, 7812, 7657, 7812, 7657, 7812, 7657, 7657, 7657, 7657, 7657, 7657, 7657, 0, 6882, 6882, 6820, 6882, 6820, 6882, 6820, 6882, 6820, 6820, 6975, 6820, 6975, 6820, 6975, 6820, 6975, 6975, 7037, 6975, 7037, 6975, 7037, 6975, 7037, 7037, 6882, 7037, 6882, 7037, 6882, 7037, 6882, 6882, 6882, 6882, 6882, 6882, 6882, 6882, 6882, 0, 8339, 8339, 8261, 8339, 8261, 8339, 8261, 8261, 8401, 8261, 8401, 8261, 8401, 8401, 8478, 8401, 8478, 8401, 8478, 8478, 8339, 8478, 8339, 8478, 8339, 8339, 8339, 8339, 8339, 8339, 8339, 0, 7440, 7440, 7300, 7440, 7300, 7440, 7300, 7300, 7223, 7300, 7223, 7300, 7223, 7223, 7362, 7223, 7362, 7223, 7362, 7362, 7440, 7362, 7440, 7362, 7440, 7440, 7440, 7440, 7440, 7440, 7440, 0, 7192, 7192, 7292, 7393, 7494, 7595, 7595, 0, 7269, 7269, 7366, 7463, 7560, 7657, 7657, 0, 5688, 5688, 5866, 6223, 6401, 6223, 5866, 5688, 0, 6401, 6401, 0, 6370, 6370, 6192, 5835, 5657, 5835, 6192, 6370, 0, 5657, 5657, 0, 9641, 9641, 9482, 9323, 9164, 9005, 9005, 0, 9610, 9610, 9451, 9292, 9133, 8974, 8974, 0, 10168, 10092, 10016, 9902, 9788, 9674, 9560, 9484, 9408, 0, 10016, 10016, 0, 9560, 9560, 0, 10183, 10107, 10031, 9917, 9803, 9689, 9575, 9499, 9424, 0, 10031, 10031, 0, 9575, 9575, 0, 10369, 10296, 10223, 10114, 10005, 9895, 9786, 9713, 9641, 0, 10223, 10223, 0, 9786, 9786, 0, 10385, 10312, 10239, 10130, 10020, 9911, 9802, 9729, 9656, 0, 10239, 10239, 0, 9802, 9802, 0, 10602, 10526, 10450, 10336, 10222, 10108, 9994, 9918, 9842, 0, 10450, 10450, 0, 9994, 9994, 0, 10617, 10541, 10465, 10351, 10237, 10123, 10009, 9933, 9858, 0, 10465, 10465, 0, 10009, 10009, 0, 8416, 8277, 8385, 8509, 8416, 8416, 0, 6432, 6246, 6060, 5874, 5688, 5735, 4107, 4138, 5766, 6479, 5099, 5130, 6510, 7044, 7579, 7579, 6789, 6851, 7781, 8866, 10106, 10819, 10839, 10860, 10881, 11051, 9300, 9346, 11098, 11532, 12198, 0, 12260, 11640, 11253, 11051, 11016, 10981, 10946, 10912, 11284, 12183, 13082, 0, 10788, 10199, 10757, 10788, 10788, 0, 10524, 10524, 10261, 9997, 9734, 9470, 9470, 0, 10602, 10602, 10338, 10075, 9811, 9548, 9548, 0, 16352, 15558, 14763, 13969, 13175, 14260, 15391, 16316, 17241, 18166, 18150, 17670, 16352, 16352, 0, 20227, 20754, 20692, 20165, 20227, 20227, 0, 16724, 17507, 18290, 18150, 17088, 16027, 14802, 15763, 16724, 16724, 0, 12400, 11408, 11470, 12446, 12400, 12400, 0, 16414, 15624, 15686, 16476, 16414, 16414, 0, 19654, 18693, 18770, 19747, 19654, 19654, 0, 5704, 4371, 4402, 5750, 5704, 5704, 0, 6138, 4836, 4836, 6138, 6138, 6138, 0, -4913, -6463, -6401, -4944, -4913, -4913, 0, 26365, 24939, 24986, 26412, 26365, 26365, 0, 0];
		gCoordY = [0, 309017, 587785, 809017, 951057, 1000000, 951057, 809017, 587785, 309017, 0, -309017, -587785, -809017, -951057, -1000000, -951057, -809017, -587785, -309017, 0,

			0, 33852, 32379, 31325, 30101, 29062, 28675, 28633, 28592, 28551, 27985, 27419, 26603, 25786, 24970, 23699, 22428, 21157, 20173, 19189, 17693, 16197, 15255, 14314, 13372, 12431, 11237, 11268, 12710, 14151, 15213, 16275, 17205, 18135, 19065, 19785, 20506, 21227, 21948, 22630, 23312, 23994, 24490, 24986, 25482, 26737, 27677, 28618, 29558, 30907, 32255, 0, 33991, 32666, 31341, 29822, 28380, 27838, 27796, 27755, 27714, 27233, 26427, 25621, 24668, 23715, 22475, 21235, 20155, 19075, 17995, 16833, 15670, 14779, 13888, 12996, 12105, 11160, 10214, 9269, 7471, 6680, 5890, 5099, 4274, 3450, 2625, 1801, 976, 573, 1007, 1550, 1472, 1069, -124, 0, 620, 1875, 2348, 2821, 3410, 3999, 4611, 5223, 5332, 5440, 6262, 7657, 9114, 11051, 11981, 13857, 14911, 15965, 17329, 18160, 18992, 19824, 20320, 20816, 21312, 22041, 22769, 23343, 23916, 24490, 25443, 26396, 27435, 28473, 29455, 30436, 31418, 32767, 34115, 0, 21638, 20611, 19584, 18557, 17530, 16259, 16523, 16918, 17313, 17825, 17747, 16941, 16135, 17019, 0, 17577, 17654, 17251, 16848, 16445, 16182, 15236, 14291, 13345, 12400, 12570, 12245, 12849, 14678, 15996, 16786, 17577, 17577, 0, 13903, 14182, 14229, 13950, 13903, 13903, 0, 14430, 14709, 14756, 14477, 14430, 14430, 0, 14880, 15159, 15205, 14926, 14880, 14880, 0, 0, 16492, 16492, 16678, 16492, 16678, 16492, 16678, 16492, 16678, 16678, 16647, 16678, 16647, 16678, 16647, 16678, 16647, 16647, 16492, 16647, 16492, 16647, 16492, 16647, 16492, 16492, 16492, 16492, 16492, 16492, 16492, 16492, 16492, 0, 16151, 16151, 16182, 16151, 16182, 16151, 16182, 16182, 16275, 16182, 16275, 16182, 16275, 16275, 16337, 16275, 16337, 16275, 16337, 16337, 16383, 16337, 16383, 16337, 16383, 16383, 16352, 16383, 16352, 16383, 16352, 16352, 16259, 16352, 16259, 16352, 16259, 16259, 16182, 16259, 16182, 16259, 16182, 16182, 16151, 16182, 16151, 16182, 16151, 16151, 16151, 16151, 16151, 16151, 16151, 0, 13082, 13082, 13159, 13082, 13159, 13159, 13082, 13159, 13082, 13082, 13004, 13082, 13004, 13004, 13082, 13004, 13082, 13082, 13082, 13082, 13082, 0, 13981, 13981, 14151, 13981, 14151, 13981, 14151, 14151, 14089, 14151, 14089, 14151, 14089, 14089, 13919, 14089, 13919, 14089, 13919, 13919, 13981, 13919, 13981, 13919, 13981, 13981, 13981, 13981, 13981, 13981, 13981, 0, 13640, 13640, 13795, 13640, 13795, 13640, 13795, 13795, 13857, 13795, 13857, 13795, 13857, 13857, 13702, 13857, 13702, 13857, 13702, 13702, 13640, 13702, 13640, 13702, 13640, 13640, 13640, 13640, 13640, 13640, 13640, 0, 15267, 15267, 15422, 15267, 15422, 15267, 15422, 15267, 15422, 15422, 15484, 15422, 15484, 15422, 15484, 15422, 15484, 15484, 15329, 15484, 15329, 15484, 15329, 15484, 15329, 15329, 15267, 15329, 15267, 15329, 15267, 15329, 15267, 15267, 15267, 15267, 15267, 15267, 15267, 15267, 15267, 0, 14461, 14461, 14647, 14461, 14647, 14461, 14647, 14647, 14709, 14647, 14709, 14647, 14709, 14709, 14523, 14709, 14523, 14709, 14523, 14523, 14461, 14523, 14461, 14523, 14461, 14461, 14461, 14461, 14461, 14461, 14461, 0, 13500, 13500, 13438, 13500, 13438, 13500, 13438, 13438, 13609, 13438, 13609, 13438, 13609, 13609, 13671, 13609, 13671, 13609, 13671, 13671, 13500, 13671, 13500, 13671, 13500, 13500, 13500, 13500, 13500, 13500, 13500, 0, 11547, 11547, 11698, 11849, 12000, 12152, 12152, 0, 11501, 11501, 11652, 11803, 11954, 12105, 12105, 0, 14198, 14198, 14291, 14477, 14570, 14477, 14291, 14198, 0, 14570, 14570, 0, 14632, 14632, 14539, 14353, 14260, 14353, 14539, 14632, 0, 14260, 14260, 0, 12369, 12369, 12411, 12454, 12496, 12539, 12539, 0, 12260, 12260, 12303, 12345, 12388, 12431, 12431, 0, 13950, 13971, 13993, 14025, 14058, 14091, 14123, 14145, 14167, 0, 13993, 13993, 0, 14123, 14123, 0, 13996, 14018, 14039, 14072, 14105, 14137, 14170, 14191, 14213, 0, 14039, 14039, 0, 14170, 14170, 0, 14492, 14512, 14532, 14563, 14593, 14623, 14653, 14673, 14694, 0, 14532, 14532, 0, 14653, 14653, 0, 14539, 14559, 14579, 14609, 14639, 14669, 14700, 14720, 14740, 0, 14579, 14579, 0, 14700, 14700, 0, 14926, 14948, 14969, 15002, 15035, 15067, 15100, 15121, 15143, 0, 14969, 14969, 0, 15100, 15100, 0, 14973, 14994, 15016, 15048, 15081, 15114, 15146, 15168, 15190, 0, 15016, 15016, 0, 15146, 15146, 0, 11640, 11749, 11873, 11764, 11640, 11640, 0, 21638, 20626, 19615, 18603, 17592, 16213, 15314, 15236, 16151, 14694, 13965, 13903, 14632, 13531, 12431, 12136, 10943, 10881, 12291, 12462, 12152, 11516, 10493, 9470, 8447, 7827, 7037, 6959, 7750, 7083, 6680, 0, 6820, 7223, 7812, 8509, 9567, 10625, 11683, 12741, 14601, 15779, 16957, 0, 11702, 12198, 12663, 11702, 11702, 0, 7579, 7579, 7463, 7347, 7230, 7114, 7114, 0, 7517, 7517, 7401, 7285, 7168, 7052, 7052, 0, 1581, 2305, 3030, 3754, 4479, 4495, 4045, 3410, 2774, 2139, 1720, 1457, 1581, 1581, 0, 976, 2402, 2418, 1038, 976, 976, 0, 21018, 21700, 22382, 22521, 21979, 21436, 20181, 20599, 21018, 21018, 0, 17019, 17949, 17980, 17050, 17019, 17019, 0, 20553, 21963, 22025, 20599, 20553, 20553, 0, 23002, 24242, 24288, 23048, 23002, 23002, 0, 17887, 18228, 18290, 17933, 17887, 17887, 0, 22521, 22335, 22444, 22614, 22521, 22521, 0, 32472, 32643, 32736, 32581, 32472, 32472, 0, 31976, 32302, 32410, 32069, 31976, 31976, 0, 0];
		gCoordZ = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, 0, -30, -841, -841, -570, -570, -300, -300, -30, -30, -841, -841, -570, -570, -300, -300, -30, -30, -841, -841, -570, -570, -300, -300, -30, -30, -841, -841, -570, -570, -300, -300, -30, -30, 0, -30, -725, -725, -377, -377, -30, -30, -725, -725, -377, -377, -30, -30, -725, -725, -377, -377, -30, -30, -725, -725, -377, -377, -30, -30, -725, -725, -377, -377, -30, -30, -725, -725, -377, -377, -30, -30, -725, -725, -377, -377, -30, -30, -725, -725, -377, -377, -30, -30, -725, -725, -377, -377, -30, -30, 0, -30, -250, -250, -30, -30, -250, -250, -30, -30, -250, -250, -30, -30, -250, -250, -30, -30, -250, -250, -30, -30, 0, -30, -450, -450, -240, -240, -30, -30, -450, -450, -240, -240, -30, -30, -450, -450, -240, -240, -30, -30, -450, -450, -240, -240, -30, -30, -450, -450, -240, -240, -30, -30, 0, -30, -630, -630, -330, -330, -30, -30, -630, -630, -330, -330, -30, -30, -630, -630, -330, -330, -30, -30, -630, -630, -330, -330, -30, -30, -630, -630, -330, -330, -30, -30, 0, -30, -600, -600, -410, -410, -220, -220, -30, -30, -600, -600, -410, -410, -220, -220, -30, -30, -600, -600, -410, -410, -220, -220, -30, -30, -600, -600, -410, -410, -220, -220, -30, -30, -600, -600, -410, -410, -220, -220, -30, -30, 0, -30, -500, -500, -265, -265, -30, -30, -500, -500, -265, -265, -30, -30, -500, -500, -265, -265, -30, -30, -500, -500, -265, -265, -30, -30, -500, -500, -265, -265, -30, -30, 0, -30, -350, -350, -190, -190, -30, -30, -350, -350, -190, -190, -30, -30, -350, -350, -190, -190, -30, -30, -350, -350, -190, -190, -30, -30, -350, -350, -190, -190, -30, -30, 0, 0, -30, -151, -191, -151, -30, 0, 0, 0, -30, -149, -189, -149, -30, 0, 0, 0, -80, -130, -30, -30, -130, -30, -80, 0, -30, 0, 0, 0, -80, -130, -30, -30, -130, -30, -80, 0, -30, 0, 0, 0, -30, -139, -176, -139, -30, 0, 0, 0, -30, -139, -176, -139, -30, 0, 0, -30, -60, -150, -60, -35, -60, -150, -60, -30, 0, -150, 0, 0, -150, 0, 0, -30, -60, -150, -60, -35, -60, -150, -60, -30, 0, -150, 0, 0, -150, 0, 0, -30, -60, -150, -60, -35, -60, -150, -60, -30, 0, -150, 0, 0, -150, 0, 0, -30, -60, -150, -60, -35, -60, -150, -60, -30, 0, -150, 0, 0, -150, 0, 0, -30, -60, -150, -60, -35, -60, -150, -60, -30, 0, -150, 0, 0, -150, 0, 0, -30, -60, -150, -60, -35, -60, -150, -60, -30, 0, -150, 0, 0, -150, 0, 0, 0, 0, 0, 0, 0, 0, 0, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, 0, 0, -30, -222, -286, -222, -30, 0, 0, 0, -30, -222, -286, -222, -30, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -30, -30, -30, -30, -30, -30, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, -30, -30, -30, -30, -30, -30, 0, 0];
		gTimer = setInterval(buildFrame, 20);
		j = 33e-3;
		H = 0;
		M = 0;
		D = 1;
		F = 0;
		P = 0;
		E = 0;
		O = 1.05;
		T = 0;
		d = 0;
		o = 0;
		v = 0;
		i = 1E3;
		c = 0;
		L = 0;
		X = 7.26;
		l = 221;
		u = 0;
		J = 0;
		h = 8;
	}

	window.onkeydown = function (e) {
		switch (e.keyCode) {
			case 38:
				upState = 1;
				break;
			case 40:
				downState = 1;
				break;
			case 37:
				leftState = 1;
				break;
			case 39:
				rightState = 1;
				break;
			case 33:
				fastState = 1;
				break;
			case 34:
				slowState = 1;
				break;
			case 36:
				u = 0;
				break;
			default:
				return;
		}
		e.preventDefault();
		e.stopPropagation();
	};

	window.onkeyup = function (e) {
		switch (e.keyCode) {
			case 38:
				upState = 0;
				break;
			case 40:
				downState = 0;
				break;
			case 37:
				leftState = 0;
				break;
			case 39:
				rightState = 0;
				break;
			case 33:
				fastState = 0;
				break;
			case 34:
				slowState = 0;
				break;
			case 36:
				break;
			default:
				return;
		}
		e.preventDefault();
		e.stopPropagation();
	};

	function drawLine(x1, y1, x2, y2) {
		var round = Math.round;
		var floor = Math.floor;
		var x, y, yx, t;

		// rotate
		var rotate = 0;
		if (Math.abs(y2 - y1) > Math.abs(x2 - x1)) {
			rotate = 1;
			t = x1;
			x1 = y1;
			y1 = t;
			t = x2;
			x2 = y2;
			y2 = t;
		}

		// sort
		if (x2 < x1) {
			t = x1;
			x1 = x2;
			x2 = t;
			t = y1;
			y1 = y2;
			y2 = t;
		}

		// slope
		var d = (x2 - x1) ? (y2 - y1) / (x2 - x1) : 1;

		// clip
		if (x1 < 0) {
			y1 += -x1 * d;
			x1 = 0;
		}
		if (x2 >= gWidth) {
			y2 -= (x2 - gWidth + 1) * d;
			x2 = gWidth - 1;
		}
		if (x2 < x1)
			return;
		if (y1 < y2) {
			if (y1 < 0) {
				x1 += -y1 / d;
				y1 = 0;
			}
			if (y2 >= gWidth) {
				x2 -= (y2 - gHeight + 1) / d;
				y2 = gHeight - 1;
			}
			if (y2 < y1)
				return;
		} else {
			if (y1 >= gHeight) {
				x1 -= (y1 - gHeight + 1) / d;
				y1 = gHeight - 1;
			}
			if (y2 < 0) {
				x2 += -y2 / d;
				y2 = 0;
			}
			if (y1 < y2)
				return;
		}

		// snap
		var e = x1 - floor(x1);
		x1 = round(x1 - e);
		y1 -= e * d;
		if (e >= 0.5) {
			x1++;
			y1 += d;
		}
		e = x2 - floor(x2);
		x2 = round(x2 - e);
		y2 -= e * d;
		if (e >= 0.5) {
			x2++;
			y2 += d;
		}

		// starting point
		e = y1 - floor(y1);
		y = floor(y1);
		x = floor(x1);
		if (e >= 0.5) {
			e -= 1;
			y += 1;
		}

		// which diagonal
		var dy = (y1 < y2) ? +1 : -1;

		// draw
		while (x <= x2 && y >= 0 && y < gHeight) {
			var w = round((0.5 - e) / d);
			if (w > x2 - x) w = x2 - x;
			if (w <= 0) {
				w = 0;
			} else if (rotate) {
				// drawVline(y,x,w);
				yx = x * gWidth + y;
				t = w;
				do {
					gPixels[yx] = 1;
					yx += gWidth;
				} while (--t > 0);
			} else {
				// drawHline(x,y,w);
				yx = y * gWidth + x;
				t = w;
				do {
					gPixels[yx] = 1;
					yx += 1;
				} while (--t > 0);
			}

			x += w;
			e += d * w - dy;
			y += dy;
		}
	}

	function buildFrame() {
		gFrameNr++;

		var startTime = new Date();
		var sin = Math.sin, cos = Math.cos, abs = Math.abs;
		var K, N, U, Z, r, W, m, B, a, t, I;

		// fresh data store
		gPixels = new Uint8Array(gWidth * gHeight);

		K = cos(j);
		N = 1e4;
		U = 0;
		M += H * dt;
		Z = D * K;
		F += dt * P;
		r = E * K;
		W = cos(O);
		m = K * W;
		H = K * T;
		O += D * dt * F / K + d / K * E * dt;
		B = sin(j);
		a = B * T * D - E * W;
		t = T * E + D * B * W;
		j += d * dt * D - dt * F * E;
		P = W * E * B - T * D;
		I = D * W + E * T * B;
		o += (E * d / K * B + v + B / K * F * D) * dt;

		var coordX = gCoordX;
		var coordY = gCoordY;
		var coordZ = gCoordZ;
		for (var p = 0; p < gCoordX.length; p++) {
			T = coordZ[p] + i;
			E = c - coordY[p];
			D = coordX[p] - L;
			K = D * m - B * T - H * E;
			if (coordX[p] + coordY[p] + coordZ[p] === 0 || K < abs(W = T * r - I * E + D * P) || abs(D = t * D + Z * T - a * E) > K)
				N = 1e4;
			else {
				var q = W / K * 4E2 + 2e2;
				var C = 2E2 + 4e2 / K * D;
				N - 1E4 && drawLine(N, U, q, C);
				N = q;
				U = C;
			}
		}


		if (upState) J++;
		if (downState) J--;
		if (leftState) u++;
		if (rightState) u--;
		if (fastState) h++;
		if (slowState) h--;

		L += dt * (X * t + P * M + m * l);
		T = X * X + l * l + M * M;
		D = v / l * 15;
		i += (B * l - M * r - X * Z) * dt;
		m = 15 * F / l;
		I = M / l;
		c += (l * H + I * M + a * X) * dt;
		E = .1 + X * 4.9 / l;
		t = T * m / 32 - I * T / 24;
		H = 32.2 * r + v * X - F * l + t / 74.5;
		K = F * M + (h * 1e4 / l - (T + E * 5 * T * E) / 3e2) / 74.5 - X * d - B * 32.2;
		a = 2.63 / l * d;
		W = d;
		d += T * (.45 - 14 / l * X - a * 130 - J * .14) * dt / 125e2 + F * dt * v;
		X += (d * l - T / 74.5 * (.19 * E + a * .64 + J / 1e3) - M * v + 32.2 * Z) * dt;
		l += K * dt;
		P = (T * (47 * I - m * 52 + E * 94 * D - t * .38 + u * .21 * E) / 1e2 + W * 179 * v) / 2312;
		v -= (W * F - T * (.63 * m - I * .086 + m * E * 19 - D * 25 - .11 * u) / 107e2) * dt;
		D = cos(o);
		E = sin(o);
		T = sin(O);

		var data = gEncoder.encode(gBPP, gRed, gGreen, gBlue, gPixels);
		gImage.src = data;

		// calculate time needed to calculate
		var diffTime = new Date();
		diffTime.setTime(diffTime.getTime() - startTime.getTime());
		diffTime = diffTime.getMilliseconds();

		// update low-pass filter
		gAvgTime += (diffTime - gAvgTime) * 0.05;

		// update status line
		gStat.innerHTML = (
			"speed:" + Math.round(l / 1.7) +
			" heading:" + Math.round((9E3 + O * 57.3) % 360) +
			" altitude: " + Math.round(i) +
			"<br/> " +
			Math.round(gAvgTime) + "mSec " +
			data.length + " bytes");
	}

</script>
</body>
</html>
